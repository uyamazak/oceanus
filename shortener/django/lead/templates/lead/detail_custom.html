{% extends "lead/base.html" %}

{% block title %}{{ query_obj.title }} - bizoceanリード管理画面{% endblock %}

{% block h1 %}{{ query_obj.title }}{% endblock %}


{% block container-class %}container-fluid{% endblock %}

{% block content %}
{% if request.user.is_staff %} <a href="{% url 'admin:lead_query_change' query_obj.id %}" target="_blank">編集</a>{% endif %}
<div class="text-right"><a href="{% url "list_leads" %}">案件一覧に戻る</a></div>
<div class="jumbotron">
        {{ query_obj.description }}
</div>



<h2>期間指定</h2>
<form action="" method="post">
{% csrf_token %}
<div class="form-group">
{{ form.as_p }}
<input class="btn btn-primary btn-sm" type="submit" value="リードを検索する" />
</div>
</form>

<script>
/* Japanese initialisation for the jQuery UI date picker plugin. */
/* Written by Kentaro SATO (kentaro@ranvis.com). */
( function( factory ) {
    if ( typeof define === "function" && define.amd ) {

        // AMD. Register as an anonymous module.
        define( [ "../widgets/datepicker" ], factory );
    } else {

        // Browser globals
        factory( jQuery.datepicker );
    }
}( function( datepicker ) {

datepicker.regional.ja = {
    closeText: "閉じる",
    prevText: "&#x3C;前",
    nextText: "次&#x3E;",
    currentText: "今日",
    monthNames: [ "1月","2月","3月","4月","5月","6月",
    "7月","8月","9月","10月","11月","12月" ],
    monthNamesShort: [ "1月","2月","3月","4月","5月","6月",
    "7月","8月","9月","10月","11月","12月" ],
    dayNames: [ "日曜日","月曜日","火曜日","水曜日","木曜日","金曜日","土曜日" ],
    dayNamesShort: [ "日","月","火","水","木","金","土" ],
    dayNamesMin: [ "日","月","火","水","木","金","土" ],
    weekHeader: "週",
    dateFormat: "yy/mm/dd",
    firstDay: 0,
    isRTL: false,
    showMonthAfterYear: true,
    yearSuffix: "年" };
datepicker.setDefaults( datepicker.regional.ja );

return datepicker.regional.ja;

} ) );
$( function() {

  $.datepicker.setDefaults( $.datepicker.regional[ "jp" ] );
  $("#id_START_DATE, #id_END_DATE").datepicker({
    dateFormat: "yy-mm-dd"
  });
} );
</script>

{% if results.total_rows  %}
<p class="text-center">全{{ results.total_rows }}件</p>
{% endif %}
<div class="container-fluid">

<table class="table table-striped table-bordered" style="font-size:0.9em;white-space: nowrap;">
  <thead class="thead-inverse">
  <tr>
  {% for s in results.schema %}
    <th>{{ s.name }}</th>
  {% endfor %}
  </tr>
  </thead>
  <tbody>
  {% for row in results.rows %}
  	<tr>
	{% for item in row %}
		<td>{{item}}</td>
	{% endfor %}
	</tr>
  {% endfor %}
  </tbody>
</table>
</div>

{% if request.user.is_staff %}
<h3>SQL</h3>
<h4>プレビュー用</h4>
<pre>
{{ query_obj.preview_sql }}
</pre>

<h4>実行されるクエリ</h4>
<pre>
{{ query_sql }}
</pre>
{% endif %}
{% endblock %}
