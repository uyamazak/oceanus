{% extends "lead/base.html" %}

{% block title %}{{ query_obj.title }} - bizoceanリード管理画面{% endblock %}

{% block h1 %}{{ query_obj.title }}{% endblock %}

{% block content %}
<div class="text-right"><a href="{% url "list_leads" %}">案件一覧に戻る</a></div>
<div class="jumbotron">
        期間を指定して、リードを検索することができます。検索後、CSV形式にてダウンロードすることができます。<br>
        ※この画面では一部の項目が表示されます。すべての項目を確認するには、ダウンロード後にご確認ください。
</div>


<h2>期間指定</h2>
<form action="" method="post">
{% csrf_token %}
<div class="form-group">
{{ form }}
<input class="btn btn-primary btn-sm" type="submit" value="リードを検索する" />
</div>
</form>


<h2>プレビュー</h2>
<div class="text-center" style="margin:10px 0;">
<a class="btn btn-lg btn-success" href="{% url "download_lead" query_obj.pk %}?start_date={{start_date}}&end_date={{end_date}}">
リードをDLする
</a>
</div>

<p class="text-center">全{{ results.total_rows }}件</p>

<table class="table table-striped table-bordered">
  <thead class="thead-inverse">
  <tr>
  {% for s in results.schema %}
    <th>{{ s.name }}</th>
  {% endfor %}
  </tr>
  </thead>
  <tbody>
  {% for row in results.rows %}
  	<tr>
	{% for item in row %}
		<td>{{item}}</td>
	{% endfor %}
	</tr>
  {% endfor %}
  </tbody>
</table>


{% if request.user.is_staff %}
<h3>SQL ※スタッフのみ</h3>
<h4>プレビュー用</h4>
<pre>
{{ query_obj.preview_sql }}
</pre>

<h4>ダウンロード用</h4>
<pre>
{{ query_obj.download_sql }}
</pre>
{% endif %}
{% endblock %}
